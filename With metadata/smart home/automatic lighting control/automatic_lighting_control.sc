{"script_uid":"lighting-control-f43-er335-dself","category":[{"iso":"ru","value":"/Умный дом"},{"iso":"en","value":"/Smart Home"},{"iso":"es","value":"/Casa inteligente"},{"iso":"de","value":"/Smart Home"}],"name":[{"iso":"ru","value":"Управление освещением"},{"iso":"en","value":"Lighting control"},{"iso":"es","value":"Control de iluminación"},{"iso":"de","value":"Lichtsteuerung"}],"description":[{"iso":"ru","value":"Назначение сценария:\nУправление освещением по движению.\n\nПринцип работы:\nРеле включается в момент возникновения нарушения в отслеживаемой зоне и выключается в момент окончания заданной задержки. Отсчет времени начинается в момент окончания нарушения.\nМожно выключить или включить выполнение сценария вручную."},{"iso":"en","value":"Scenario purpose:\nLighting control by motion.\n\nPrinciple of operation:\nThe relay turns on when movement detects in the monitored area and turns off after a preprogrammed delay. The delay countdown begins at the end of the movement.\nYou can enable or disable the script manually."},{"iso":"es","value":"Designación del escenario:\nControl de iluminación por movimiento.\n\nPrincipio de funcionamiento:\nEl relé se activa cuando ocurre una violación en la zona monitoreada y se desactiva cuando finaliza el retardo establecido. La cuenta atrás comienza al final de la violación.\nPuede deshabilitar o habilitar manualmente la ejecución de los escenarios."},{"iso":"de","value":"Funktion:\nLichtsteuerung durch Bewegung.\n\nFunktionsprinzip:\nDas Relais schaltet sich ein, wenn eine Störung in der überwachten Zone auftritt, und schaltet sich aus, wenn die voreingestellte Verzögerungszeit abläuft. Der Countdown beginnt, sobald die Störung behoben wurde.\nSie können die manuelle Ausführung des Szenarios deaktivieren oder aktivieren."}],"description_alt":[{"iso":"ru","value":"Назначение сценария:<br>Управление освещением по движению.<br><br>Принцип работы:<br>Реле включается в момент возникновения нарушения в отслеживаемой зоне и выключается в момент окончания заданной задержки. Отсчет времени начинается в момент окончания нарушения.<br>Можно выключить или включить выполнение сценария вручную."},{"iso":"en","value":"Scenario purpose:<br>Lighting control by motion.<br><br>Principle of operation:<br>The relay turns on when movement detects in the monitored area and turns off after a preprogrammed delay. The delay countdown begins at the end of the movement.<br>You can enable or disable the script manually."},{"iso":"es","value":"Designación del escenario:<br>Control de iluminación por movimiento.<br><br>Principio de funcionamiento:<br>El relé se activa cuando ocurre una violación en la zona monitoreada y se desactiva cuando finaliza el retardo establecido. La cuenta atrás comienza al final de la violación.<br>Puede deshabilitar o habilitar manualmente la ejecución de los escenarios."},{"iso":"de","value":"Funktion:<br>Lichtsteuerung durch Bewegung.<br><br>Funktionsprinzip:<br>Das Relais schaltet sich ein, wenn eine Störung in der überwachten Zone auftritt, und schaltet sich aus, wenn die voreingestellte Verzögerungszeit abläuft. Der Countdown beginnt, sobald die Störung behoben wurde.<br>Sie können die manuelle Ausführung des Szenarios deaktivieren oder aktivieren."}],"source":"; common TOS sizes\nb equ 0\nw equ 1\ndw equ 2\n\n;source_zone equ 1 ; (param) zone to detect from\n;delay_to_off equ 45 ; (param) delay in seconds\n\n; push byte macro\npb macro\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; push word macro\npw macro\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; exp instruction with parameters\nex macro\n psh ($1 & 3)\n nib ((($3 & 1) << 3) | ($2 & 3))\n exp\nendm\n\n; mov instruction with parameters\nup macro\n psh (((($1 & 3) | ($2 << 2)) >> 4) & 15)\n nib (($1 & 3) | ($2 << 2) & 15)\n mov\nendm\n\n; BEGIN\ncheck_switch\n ; check switch\n ; if has - change 'work flag'\n ; else - check 'work flag'\n pb HAS_SWITCH\n inp b, b\n pop b\n snz\n bra check_state ; continue\n pb change_state ; has switch\n jmp b\n \ncheck_state\n swp b ; bring 'work flag' to top\n dup b ; save 'work flag'\n ; check 'work flag'\n ; if 0 - script enabled, check detector\n ; else - set off\n pop b\n snz\n bra check_detector ; worked\n swp b ; bring 'last state' to top\n pop b ; dispose it\n pb set_off\n jmp b\n \ncheck_detector\n ; get source zone detector flag\n pw ZONE_DETECT_FLAG_BASE + source_zone - 1\n inp w, b\n ; check source zone detector flag\n ; if 1 - detector active\n ; else - detector inactive\n pop b\n skz\n bra detector_active\n\ndetector_inactive\n up b, 2 ; bring 'last detector reading' to top\n ; check 'last detector reading' value\n ; if was detect - check 'last state'\n ; else - go to not_detect\n pop b \n snz\n bra not_detect\n swp b ; bring 'last state' to top\n ; if 'last state' = 0 - check timer\n ; else - start timer\n pop b\n skz\n bra start_timer ; was on, check timer\n pb check_timer ; was off\n jmp b\n\nnot_detect\n swp b ; bring 'last state' to top\n ; check 'last state'\n ; if 0 - continue\n ; else - check timer\n pop b\n snz\n bra continue ; was off\n pb check_timer ; was on, check timer\n jmp b\n\ndetector_active\n up dw, 3 ; bring 'timer end time' to top\n pop dw ; dispose it\n up b, 2 ; bring 'last detector reading' to top\n pop b ; dispose it\n swp b ; bring 'last state' to top\n pop b ; dispose it\n psh 1 ; set 'last detector reading'\n swp b ; bring 0 up (work flag)\n bra set_on\n \nset_off\n psh 0\n ret\n \nstart_timer\n ; get current time\n pb TIMESTAMP\n inp b, dw\n pw delay_to_off\n ex w, dw, 0\n add dw ; calculate 'timer end time'\n up b, 4 ; bring 'work flag' to top\n psh 0 ; set 'last detector reading'\n swp b ; bring 'work flag' to top\n bra set_on\n \ncontinue\n swp b ; bring 'last reading' to top\n pop b ; dispose it\n psh 0 ; set 'last reading'\n swp b ; bring 'work flag' to top\n bra set_off\n \nnot_time\n psh 0 ; set 'last detector reading'\n up b, 5 ; bring 'work flag' to top\n\nset_on \n psh 1\n ret\n\ncheck_timer\n up dw, 1 ; bring 'timer end time' to top\n ; compare 'current time' with 'timer end time'\n dup dw\n pb TIMESTAMP\n inp b, dw\n cmp dw\n ; if 'current time' greater  - set off\n ; else - go to not_time\n skn\n bra not_time\n pop dw ; dispose 'timer end time'\n pb set_off\n jmp b\n\nchange_state\n swp b ; bring 'work flag' to top\n pop b ; dispose it\n ; read switch\n ; if 0 - dispose all, set 'work flag' = 1(disabled), set off\n ; else - set 'work flag' = 0(enabled), check state\n pb SWITCH\n inp b, b\n pop b\n snz\n bra set_work ; set work\n ; set stop\n ; dispose all\n pop w\n pop dw\n psh 1 ; set 'work flag' disabled\n pb set_off\n jmp b\n \nset_work\n psh 0 ; set 'work flag' enabled\n swp b ; push 'work flag' on second line in stack\n pb check_state\n jmp b","extra":{"switch":{"rows":[{"items":[{"content":[{"iso":"ru","value":"Включить"},{"iso":"en","value":"Turn on"},{"iso":"es","value":"Encender"},{"iso":"de","value":"Anmachen"}],"value":0},{"content":[{"iso":"ru","value":"Выключить"},{"iso":"en","value":"Turn off"},{"iso":"es","value":"Apagar"},{"iso":"de","value":"Schalte aus"}],"value":1}]}],"size":1}},"params":[{"name":"source_zone","format":"^([1-9]|[12][0-9]|3[0-2])$","type":"zone","description":[{"iso":"ru","value":"Отслеживаемая зона"},{"iso":"en","value":"Zone"},{"iso":"es","value":"Zona"},{"iso":"de","value":"Zone"}]},{"name":"delay_to_off","format":"^([0-9]|[1-8][0-9]|9[0-9]|[1-8][0-9]{2}|9[0-8][0-9]|99[0-9]|[1-8][0-9]{3}|9[0-8][0-9]{2}|99[0-8][0-9]|999[0-9]|10[0-7][0-9]{2}|10800)$","type":"int","description":[{"iso":"ru","value":"Задержка на выключение (сек)"},{"iso":"en","value":"Shutdown delay (sec)"},{"iso":"es","value":"Retardo de apagado (seg)"},{"iso":"de","value":"Abschaltverzögerung (sek)"}]}],"firmwares":["67111504","21954820","21889283","21954819","22020353","22020355","22020356","22151427","22216961","22216963","22216964","22282499","22348035","22413571","22479107","22544641","22544643","39452932","22610177","22610179","22675715","22741251","22806787","22872323","39584004","22937859","39649540","23068931","39846148","23134467","39911684","39977220","23265539","40042756","40173828","23527683","23593219","23265537","40435972","23658755","23724291","23789827","23855363","40632580","23920899"]}