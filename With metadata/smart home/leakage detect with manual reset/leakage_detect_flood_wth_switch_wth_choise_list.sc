{"script_uid":"smart-leak-switch-fhjdf9-g4t-0e1","category":[{"iso":"ru","value":"/Умный дом"},{"iso":"en","value":"/Smart Home"},{"iso":"es","value":"/Casa inteligente"},{"iso":"de","value":"/Smart Home"}],"name":[{"iso":"ru","value":"Утечка воды"},{"iso":"en","value":"Water leakage"},{"iso":"es","value":"Fugas de agua"},{"iso":"de","value":"Wasseraustritt"}],"description":[{"iso":"ru","value":"Сценарий 'Утечка воды' меняет состояние управляемого им выхода в зависимости от состояния зарегистрированных в системе датчиков утечки воды Астра-361 исп. РК следующим образом:\n - выход включается (кран открыт) если все извещатели утечки воды Астра-361 исп. РК в НОРМЕ;\n - выход включается (кран открыт)  при появлении ПОЖАРА в любом из разделов не зависимо от состояния извещателей утечки воды Астра-361 исп. РК и состояния охранных» разделов;\n - выход выключается (кран закрыт) при появлении НАРУШЕНИЯ в любом из извещателей утечки воды Астра-361 исп. РК и отсутствии НАРУШЕНИЯ в разделах пожарного типа;\n - выход выключается (кран закрыт) если все разделы охранного типа ВЗЯТЫ на охрану и нет НАРУШЕНИЯ в разделах пожарного типа.\n\nЕсть возможность установить ручное восстановление после утечки. При необходимости реализации обратной логики работы установленного в системе крана имеется возможность включения инверсированный режима работы управляемого выхода при настройке параметров сценария."},{"iso":"en","value":"The 'Water leakage' scenario changes the state of the output assigned to it depending on the state of the  registered water leakage sensors Astra-361 ver. RF as follows:\n - the output turns on (the water tap is open) if all water leakage sensors Astra-361 ver. RF are in NORMAL state;\n - the output turns on (the water tap is open) when the FIRE ALARM appears in any of fire-type partitions, regardless of the state of the water leakage sensors Astra-361 ver. RF and state of intrusion-type partitions;\n - the output turns off (the water tap is closed) at triggering of any of the water leakage sensors Astra-361 ver. RF and the absence of FIRE ALARMS in fire-type partitions;\n - the output turns off (the water tap is closed) if all intrusion-type partitions are ARMED and there are no FIRE ALARMS in fire-type partitions.\n\nIt is also possible to manually restore the output after water leakage. The scenario is inverted by setting the Inversion parameter to ON."},{"iso":"es","value":"El escenario 'Fugas de agua' cambia el estado de la salida dependiendo del estado de los sensores de fugas de agua Astra-361 ver. RF registrados de la siguiente manera:\n - la salida se enciende (el grifo de agua está abierto) cuando todos los sensores de fugas de agua Astra-361 ver. RF están en estado de NORMA;\n - la salida se enciende (el grifo de agua está abierto) cuando  el evento de INCENDIO aparece en cualquiera de las secciones independiente del estado de los sensores de fugas de agua Astra-361 ver. RF y el estado de secciones del tipo \"intrusión\";\n - la salida se apaga (el grifo de agua está cerrado) cuando todas las secciones del tipo \"intrusión\" están ARMADOS y no hay VIOLACIÓN en las secciones del tipo \"incendio\";\n - la salida se apaga (el grifo está cerrada) si todas las secciones del tipo \"intrusión\" están ARMADOS y no hay VIOLACIONES en las secciones del tipo \"incendio\".\n\nEs posible establecer una restauración manual después de fugas. Para utilizar la lógica inversa del escenario, es necesario activar el parámetro Inversión."},{"iso":"de","value":"Das Szenario „Wasseraustritt“ ändert den Zustand des gesteuerten Relais in Abhängigkeit von dem Zustand des Wassermelders Astra-361 Ver. RF wie folgt: - der Ausgang schaltet sich ein (der Hahn ist offen), wenn alle Wasserlecksensoren Astra-361 ver. RF sich im NORMALZUSTAND befinden. Es schaltet sich ein (der Hahn ist offen), wenn in einem der Bereiche FEUER ausbricht, unabhängig vom Zustand der Wasserleckagesensoren Astra-361 ver. RF und Bereichen vom Typ \"Einbruchschutz\"; -der  Ausgang schaltet sich aus (der Hahn ist geschlossen), wenn in einem der Wasserlecksensoren Astra-361 RF STÖRUNG auftritt und keine STÖRUNG in Bereichen vom Typ \"Feuer\" vorliegt; - der Ausgang  schaltet sich aus (der Hahn ist geschlossen), wenn alle Bereiche vom Typ \"Einbruchschutz\" scharfgeschaltet sind und es keine STÖRUNG in Bereichen vom Typ \"Feuer\" gibt. Es besteht die Möglichkeit die Sensoren nach Wasseraustritt manuell wiederherzustellen. Die Invertierung des Betriebsmodus kann in den Einstellungen des Szenarios programmiert werden."}],"description_alt":[{"iso":"ru","value":"Сценарий <b>Протечка воды</b> меняет состояние управляемого им реле в зависимости от состояния зарегистрированных в системе датчиков протечки воды Астра-361 исп. РК следующим образом:<br>- реле <b>включается</b> (кран открыт) если все извещатели утечки воды Астра-361 исп. РК в НОРМЕ.<br>- реле <b>включается</b> (кран открыт)  при появлении ПОЖАРА в любом из разделов не зависимо от состояния извещателей утечки воды Астра-361 исп. РК и «охранных» разделов.<br>- реле <b>выключается</b> (кран закрыт) при появлении НАРУШЕНИЯ в любом из извещателей утечки воды Астра-361 исп. РК и отсутствии НАРУШЕНИЯ в разделах типа «пожарный».<br>- реле <b>выключается</b> (кран закрыт) если все разделы типа «охранный» ВЗЯТЫ на охрану и нет НАРУШЕНИЯ в разделах типа «пожарный».<br><br>Есть возможность установить ручное восстановление после протечки.При необходимости реализации обратной логики работы установленного в системе крана имеется возможность включения инверсированный режима работы управляемого реле при настройке параметров сценария."},{"iso":"en","value":"The <b> Water leakage </b> scenario changes the state of the output assigned to it depending on the state of the  registered water leakage sensors Astra-361 ver. RF as follows: <br> - the output <b> turns on </b> (the water tap is open) if all water leakage sensors Astra-361 ver. RF are in NORMAL state. <br> - the output <b> turns on </b> (the water tap is open) when the FIRE ALARM appears in any of fire-type partitions, regardless of the state of the water leakage sensors Astra-361 ver. RF and state of intrusion-type partitions. <br> - the output <b> turns off </b> (the water tap is closed) at triggering of any of the water leakage sensors Astra-361 ver. RF and the absence of FIRE ALARMS in fire-type partitions. <br> - the output <b> turns off </b> (the water tap is closed) if all intrusion-type partitions are ARMED and there are no FIRE ALARMS in fire-type partitions. <br > <br> It is also possible to manually restore the output after water leakage. The scenario is inverted by setting the Inversion parameter to ON."},{"iso":"es","value":"El escenario <b>Fugas de agua</b> cambia el estado de la salida dependiendo del estado de los sensores de fugas de agua Astra-361 ver. RF registrados de la siguiente manera: <br> - la salida <b> se enciende </b> (el grifo de agua está abierto) cuando todos los sensores de fugas de agua Astra-361 ver. RF están en estado de NORMA. <br> - la salida <b>se enciende </b> (el grifo de agua está abierto) cuando  el evento de INCENDIO aparece en cualquiera de las secciones independiente del estado de los sensores de fugas de agua Astra-361 ver. RF y el estado de secciones del tipo \"intrusión\". <br> - la salida <b> se apaga </b> (el grifo de agua está cerrado) cuando todas las secciones del tipo \"intrusión\" están ARMADOS y NO HAY VIOLACIÓN en las secciones del tipo \"incendio\". <br> - la salida <b> se apaga </b> (el grifo está cerrada) si todas las secciones del tipo \"intrusión\" están ARMADOS y no hay VIOLACIONES en las secciones del tipo \"incendio\". <br > <br> Es posible establecer una restauración manual después de fugas. Para utilizar la lógica inversa del escenario, es necesario activar el parámetro Inversión."},{"iso":"de","value":"Das Szenario <b> Wasseraustritt </b> ändert den Zustand des gesteuerten Relais in Abhängigkeit von Zuständen der registrierten Wasserlecksensoren Astra-361 Ver. RF wie folgt: <br> - das Relais <b> schaltet sich ein </b> (der Hahn ist offen), wenn alle Wasserlecksensoren Astra-361 Ver. RF im NORMALZUSTAND sind; <br> - das Relais <b> schaltet sich ein </b> (der Hahn ist offen), wenn in einem der Bereiche FEUER ausbricht unabhängig vom Zustand der Wasserlecksensoren Astra-361 ver. RF - und den Zuständen der Bereiche vom Typ \"Einbruchschutz\"; <br> - das Relais <b> schaltet sich aus </b> (der Hahn ist geschlossen), wenn in einem der Wasserlecksensoren Astra-361 Ver RF. STÖRUNG eintritt und keine STÖRUNG in den Bereichen vom Typ \"Feuer\" vorliegt; <br> - das Relais <b> schaltet sich aus </b> (der Hahn ist geschlossen), wenn alle Bereiche vom Typ \"Einbruchschutz\" scharfgeschaltet sind und es keine STÖRUNG in den Bereichen vom Typ \"Feuer\" gibt. <br > <br> Es besteht die Möglichkeit eine manuelle Wiederherstellung nach Wasseraustritt einzustellen. Die umgekehrte Logik des Wasserhahnbetriebs kann in den Einstellungen des Szenarios durch die Aktivierung des inversen Betriebsmodus des gesteuerten Relais realisiert werden."}],"source":"; common TOS sizes\nb equ 0\nw equ 1\ndw equ 2\n\n;action equ 0 ; (param) active state of relay\n;manual equ 1 ; (param) manual reset of flood\n\nALARM_REASON_FLOOD equ 23 ; flood alarm reason\n\npb macro ; byte\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; push word macro\npw macro\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n ; get 'manual' flag parameter\n psh manual\n pop b ; read it\n ; if 'manual' - go to manual_reset\n ; else - go to auto\n skz\n bra manual_reset\nauto\n pop b ; dispose 'last state'\n pop b ; dispose 'was flood'\n bra check_fire\nmanual_reset\n psh action ; get active ralay state\n xor b ; calculate 'last state'\n pop b\n ; if was off - read 'was flood'\n snz\n bra check_fire\n pop b\n ; if 'was flood' = 1 - wait switch\n ; else - check fire\n snz\n bra check_fire\n \nwait_switch\n ; get switch value\n pb HAS_SWITCH\n inp b, b\n pop b ; read switch value\n ; if has switch - reset, continue script\n ; else - check if has fire before end\n skz\n bra check_fire\n ; get fire sections mask\n pb FIRE_SECTIONS\n inp b, b\n ; get alarming sections mask\n pb ALARMING_SECTIONS\n inp b, b\n ; calculate alarminf fire sections\n and b\n ; if has fire alarm - set on\n ; else - no fire alarm, set off\n snz\n bra not_fire ; not fire\n pb set_on ; fire\n jmp b\n \nnot_fire\n pop b ; dispose fire alarm sections mask\n psh 1 ; set 'was flood'\n pb set_off\n jmp b\n \ncheck_fire\n ; get fire sections mask\n pb FIRE_SECTIONS\n inp b, b\n ; get alarmed sections mask\n pb ALARMING_SECTIONS\n inp b, b\n ; calculate alarmed fire sections mask\n and b\n ; if there any fire alarm - set on\n ; else - check zone\n snz \n bra check_zone ; not fire\n pop b ; dispose alarming fire sections mask\n pb set_on ; fire\n jmp b\n\ncheck_zone\n ; get first zone alarm reason address\n pw INP_ZONE_ALARM_REASON_BASE\nloop\n dup w ; save current zone alarm reason address\n inp w, b ; get current zone alarm reason\n ; get flood alarm reason\n pb ALARM_REASON_FLOOD\n ; compare 'flood alarm reason' and 'current zone alarm reason'\n cmp b\n ; if equal - check flood\n ; else - continue\n snz\n bra check_flood\n inc w ; next zone alarm reason address\n ; check if we out of range\n dup w\n pw INP_ZONE_ALARM_REASON_BASE + 32\n cmp w\n ; if out of range - check arm\n ; else - continue loop\n skz\n bra loop\n \ndispose_switch\n ; get switch value\n pb HAS_SWITCH\n inp b, b\n pop b ; dispose switch value\n \ncheck_arm\n ; dispose 'last zone alarm reason address' and 'alarming fire sections mask'\n pop w\n pop b\n ; get armed sections mask\n psh ARMED_SECTIONS\n inp b, b\n ; if has any - get guard sections mask\n ; else - set on\n snz\n bra set_on\n psh GUARD_SECTIONS\n inp b, b\n ; compare armed sections and guard sections\n cmp b\n ; if equal - all armed, set off\n ; else - set on\n skz\n bra set_on\n psh 0 ; set 'was flood'\n bra set_off\n\ncheck_flood\n ; calculate current zone number\n dup w ; save current zone alarm reason address\n pw INP_ZONE_ALARM_REASON_BASE\n sub w\n ; get zone alarm flag base address\n pw ZONE_ALARM_FLAG_BASE\n add w ; calculate address of current zone alarm flag\n inp w, b ; get current zone alarm flag\n ; if has alarm - dispose and set off\n ; else continue loop\n skz\n bra dispose\n pop b ; dispose 'zone alarm flag'\n inc w ; next zone alarm reason address\n pb loop\n jmp b\n \ndispose\n pop dw ; dispose 'zone alarm flag', 'current zone alarm reason address' and 'alarming fire sections mask'\n psh 1 ; set 'was flood'\n\nset_off\n psh ~action & 1\n ret\n \nset_on\n psh action & 1\n ret","params":[{"name":"action","format":"^([01])$","type":"list","default":"1","extra":[{"name":"turn_on","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"1"},{"name":"turn_off","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"0"}],"description":[{"iso":"ru","value":"Инверсия"},{"iso":"en","value":"Inversion"},{"iso":"es","value":"Inversión"},{"iso":"de","value":"Invertieren"}]},{"name":"manual","format":"^([01])$","type":"list","default":"0","extra":[{"name":"yes","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"1"},{"name":"no","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"0"}],"description":[{"iso":"ru","value":"Ручное восстановление"},{"iso":"en","value":"Manual recovery"},{"iso":"es","value":"Restauración manual"},{"iso":"de","value":"Manuelle Wiederherstellung"}]}],"extra":{"switch":{"rows":[{"items":[{"content":[{"iso":"ru","value":"Восстановить"},{"iso":"en","value":"Restore"},{"iso":"es","value":"Restaurar"},{"iso":"de","value":"Wiederherstellen"}],"value":1}]}],"size":1}},"firmwares":["22216961","22216963","22216964","22282499","22348035","22413571","22479107","22544641","22544643","22610177","22610179","22675715","22741251","39452932","22806787","22872323","39584004","22937859","39649540","23068931","39846148","23134467","39911684","39977220","23265539","40042756","40173828","23527683","23593219","23265537","40435972","23658755","23724291","23789827","23855363","40632580","23920899","24117507","24183043"]}