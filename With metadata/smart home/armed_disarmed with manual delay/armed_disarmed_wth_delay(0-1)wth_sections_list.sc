{"script_uid":"guard-armdis-secti-delayn-g4t-01","category":[{"iso":"ru","value":"/Умный дом"},{"iso":"en","value":"/Smart Home"},{"iso":"es","value":"/Casa inteligente"},{"iso":"de","value":"/Smart Home"}],"name":[{"iso":"ru","value":"Взят/Снят с отсрочкой"},{"iso":"en","value":"Armed/Disarmed with delay"},{"iso":"es","value":"Armado/Desarmado con retraso"},{"iso":"de","value":"Scharf/Unscharf mit Verzögerung"}],"description":[{"iso":"ru","value":"Сценарий 'Взят/Снят с отсрочкой' меняет состояние управляемого им выхода через заданное время в зависимости от состояния (взят/снят) отслеживаемых разделов следующим образом:\n - выход включается при постановке на охрану всех отслеживаемых разделов(если установлено время зажержки, то по его истечению);\n - выход выключается при снятии с охраны любого из отслеживаемых разделов.\n\nДля применения обратной логики работы сценария необходимо включить инверсию при настройке параметров сценария."},{"iso":"en","value":"The 'Armed/Disarmed with delay' scenario changes the state of the output after specified time delay depending on the state (armed/disarmed) of assigned partitions as follows:\n - the output turns on when arming all partitions (on expiry of the delay time, if it is set);\n - the output turns off when disarming any of assigned partitions.\n\nThe scenario is inverted by setting the Inversion parameter to ON."},{"iso":"es","value":"El escenario 'Armado/Desarmado con retraso' cambia el estado de la salida después de un tiempo especificado dependiendo del estado (armado/desarmado) de las secciones asignadas de la siguiente manera:\n - la salida se enciende al armar todas las secciones asignadas (después del tiempo de retraso, si está configurado);\n - la salida se apaga al desarmar cualquiera de las secciones asignadas.\n\nPara utilizar la lógica inversa del escenario, es necesario activar el parámetro Inversión."},{"iso":"de","value":"Das Szenario \"Scharf/Unscharf mit Verzögerung\" ändert den Zustand des gesteuerten Relais nach der programmierten Verzögerungszeit in Abhängigkeit von Zuständen der überwachten Bereiche (scharf/unscharf) wie folgt: - der Ausgang schaltet sich nach Ablauf der Verzögerungszeit (falls eingestellt) ein, sobald alle dem Ausgang zugewiesenen Bereiche scharfgeschaltet werden; - der Ausgang schaltet sich aus, sobald einer der Bereiche unscharfgeschaltet wird. Die Invertierung des Betriebsmodus kann in den Einstellungen des Szenarios programmiert werden."}],"description_alt":[{"iso":"ru","value":"Сценарий <b>Взят/Снят с отсрочкой</b> меняет состояние управляемого им реле <b>через заданное время</b> в зависимости от состояния <b>взятия/снятия</b> отслеживаемых разделов следующим образом:<br><br>-реле <b>включается</b> при постановке на охрану всех отслеживаемых разделов(если установлено время зажержки, то по его истечению);<br>-<b>выключается</b> при снятии с охраны любого из отслеживаемых разделов.<br><br>Для применения обратной логики работы сценария необходимо включить инверсию при настройке параметров сценария"},{"iso":"en","value":"The <b>Armed/Disarmed with delay</b> scenario changes the state of the output <b> after specified time delay</b> depending on the state <b>Armed/Disarmed</b> of assigned partitions as follows: <br> <br>-output turns <b>ON</b> when arming all partitions (on expiry of the delay time, if it is set); <br>-output turns <b>OFF</b> when disarming any of assigned partitions. <br> <br> The scenario is inverted by setting the Inversion parameter to ON."},{"iso":"es","value":"El escenario <b>Armado/Desarmado con retraso</b> cambia el estado de la salida<b> después de un tiempo especificado </b>dependiendo del estado <b>armado/desarmado</b> de las secciones asignadas de la siguiente manera: <br> <br> - la salida <b> se enciende</b> al armar todas las secciones asignadas (después del tiempo de retraso, si está configurado); <br> - <b>se apaga</b> la salida al desarmar cualquiera de las secciones asignadas. <br> <br> Para utilizar la lógica inversa del escenario, es necesario activar el parámetro Inversión."},{"iso":"de","value":"Das Szenario <b>\"Scharf/Unscharf mit Verzögerung\"</b> ändert den Zustand des gesteuerten Relais <b>nach der programmierten Verzögerungszeit</b> in Abhängigkeit von Zuständen <b>\"scharf/unscharf\"</b>der überwachten Bereiche wie folgt:<br><br>- der Ausgang <b>schaltet sich nach Ablauf der Verzögerungszeit (falls eingestellt) ein</b>, sobald alle dem Ausgang zugewiesenen Bereiche scharfgeschaltet werden;<br>- der Ausgang <b>schaltet sich aus</b>, sobald einer der Bereiche unscharfgeschaltet wird. <br><br>Für die Umkehrung der Arbeitslogik des Szenarios muss die Invertierung in den Einstellungen des Szenarios programmiert werden."}],"source":"; common TOS sizes\nb equ 0\nw equ 1\ndw equ 2\n\n;sections equ 13 ; (param) monitored sections\n;delay equ 3 ; (param) up to 16 bits in seconds\n;action equ 1 ; (param) active state (what to do `on` or `off` when active)\n\npb macro ; byte\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; push word macro\npw macro\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; exp instruction with parameters\nex macro\n psh ($1 & 3)\n nib ((($3 & 1) << 3) | ($2 & 3))\n exp\nendm\n\n; BEGIN\n ; set off if no selected sections\n pb sections\n pop b\n snz\n ret\n ; check last state\n ; if was active - continue \n ; else - go to was_inactive\n psh action\n xor b\n pop b\n skz\n bra was_inactive ; was off\n ; check for all monitored guard section armed\n ; if yes - set on\n ; else - set off\n pb ARMED_SECTIONS ; was on\n inp b, b\n pb sections\n and b\n pb GUARD_SECTIONS\n inp b, b\n pb sections\n and b\n cmp b\n skz\n bra set_off\n bra set_on\n\nwas_inactive\n ; check for all monitored guard section armed\n ; if yes - check for timer\n ; else dispose all and set off\n pb ARMED_SECTIONS\n inp b, b\n pb sections\n and b\n pb GUARD_SECTIONS\n inp b, b\n pb sections\n and b\n cmp b\n snz\n bra check_timer_on ; armed\n pop dw ; disarmed\n bra set_off\n \nset_on\n psh action & 1\n ret\n \nset_off\n psh ~action & 1\n ret \n \ncheck_timer_on\n ; check if timer started\n ; if yes - check timer\n ; else start timer\n dup dw\n pop dw\n snz\n bra start_timer\n \ncheck_timer\n dup dw ; save 'delay end time'\n ; get 'current timestamp'\n psh TIMESTAMP\n inp b, dw\n ; compare 'current timestamp' and 'delay end time'\n ; if 'current timestamp' is greater - dispose 'delay end time' and set on\n ; else set off\n cmp dw\n skn\n bra set_off\n pop dw\n bra set_on\n \nstart_timer\n ; calculate timer end time and set off\n pop dw ; dispose everything\n ; get current timestamp\n psh TIMESTAMP\n inp b, dw\n pw delay\n ex w, dw, 1\n add dw ; add 'delay time' to 'current timestamp'\n bra set_off","params":[{"name":"action","format":"^([01])$","type":"list","default":"1","extra":[{"name":"turn_on","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"1"},{"name":"turn_off","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"0"}],"description":[{"iso":"ru","value":"Инверсия"},{"iso":"en","value":"Inversion"},{"iso":"es","value":"Inversión"},{"iso":"de","value":"Invertierung"}]},{"name":"delay","format":"^([1-9]|[1-8][0-9]|9[0-9]|[1-8][0-9]{2}|9[0-8][0-9]|99[0-9]|[1-8][0-9]{3}|9[0-8][0-9]{2}|99[0-8][0-9]|999[0-9]|10[0-7][0-9]{2}|10800)$","type":"int","description":[{"iso":"ru","value":"Отсрочка (в сек.)"},{"iso":"en","value":"Delay (in sec.)"},{"iso":"es","value":"Retraso (segundos)"},{"iso":"de","value":"Verzögerung (in Sekunden)"}]},{"name":"sections","format":"^([0-9]|[1-8][0-9]|9[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$","type":"sections","extra":[{"name":"section_type","value":"1"}],"description":[{"iso":"ru","value":"Отслеживаемые разделы"},{"iso":"en","value":"Partitions"},{"iso":"es","value":"Secciones "},{"iso":"de","value":"Überwachte Bereiche"}]}],"firmwares":["67111504","21954820","21889283","21954819","22020353","22020355","22020356","22151427","22216961","22216963","22216964","22282499","22348035","22413571","22479107","22544641","22544643","22610177","22610179","22675715","22741251","39452932","22806787","22872323","39584004","22937859","39649540","23068931","39846148","23134467","39911684","39977220","23265539","40042756","40173828","23527683","23593219","23265537","40435972","23658755","23724291","23789827","23855363","40632580","23920899","24117507","24183043"]}