{"script_uid":"termo-statvd-hyste-everyd-g4t-54","category":[{"iso":"ru","value":"/Умный дом/Температура"},{"iso":"en","value":"/Smart Home/Temperature"},{"iso":"es","value":"/Casa inteligente/Temperatura"},{"iso":"de","value":"/Smart Home/Temperatur"}],"name":[{"iso":"ru","value":"Термостат многозонный суточный, гистерезис"},{"iso":"en","value":"Multipoint daily thermostat, hysteresis"},{"iso":"es","value":"Termostato multizona de ciclo diário, histéresis"},{"iso":"de","value":"Täglicher Mehrsensorenthermostat, Hysteresis"}],"description":[{"iso":"ru","value":"Сценарий 'Термостат многозонный суточный, гистерезис' предназначен для управления климатическим оборудованием по показаниям одного или нескольких температурных датчиков Астра-3731 и любых других датчиков Астра, передающих информацию о температуре.\nСценарий позволяет выбрать тип системы, оборудованием которого требуется управлять - отопление или охлаждение.\nДля системы «отопление»: выход включается при достижении заданного значения нижней границы температур и выключается при достижении верхней границы.\nДля системы «охлаждение»: выход включается при достижении заданного значения верхней границы температур и выключается при достижении нижней границы.\nДля определения верхних и нижних границ служит параметр «гистерезис». Верхняя граница - заданное значение температуры + гистерезис. Нижняя граница – заданное значение температуры – гистерезис.\n\nОсобенности:\n - в качестве источников температуры может быть указан один или несколько датчиков;\n - точность поддержания температуры зависит от количества датчиков (для 2 датчиков – 0.5 °С, для 10 датчиков – 0.1 °С)."},{"iso":"en","value":"The 'Multipoint daily thermostat, hysteresis' scenario is designed to control climatic equipment according to the measurements of temperature by one or more temperature sensors Astra-3731 or/and any other Astra sensors that can measure and transmit temperature information.\nThe scenario allows to select the type of the system - heating or cooling.\nFor the \"heating\" system: the output turns on when the pre-set value of the lower threshold is reached and turns off when the upper temperature threshold is reached.\nFor the cooling system: the output turns on when the pre-set value of the upper temperature threshold is reached and turns off when the lower threshold is reached.\nTo determine the upper and lower threshold serves the hysteresis parameter. The upper threshold is determined as the 'pre-set temperature + hysteresis'. The lower threshold is determined as the 'pre-set temperature - hysteresis'.\n\nFeatures:\n - one or more sensors can be specified as temperature sources;\n - the accuracy of temperature maintenance depends on the quantity of sensors (with 2 sensors - 0.5 ° С, with 10 sensors - 0.1 ° С)."},{"iso":"es","value":"El escenario 'Termostato multizona de ciclo diário, histéresis' está diseñado para controlar equipos climáticos midiendo la temperatura mediante uno o más sensores de temperatura Astra-3731 o cualquier otro sensor Astra que pueda medir y transmitir Información de temperatura.\nEl escenario permite seleccionar el tipo de sistema: calefacción o enfriamiento.\nPara el sistema de \"calefacción\": la salida se enciende cuando se alcanza el valor preestablecido del umbral inferior y se apaga cuando se alcanza el umbral de temperatura superior.\nPara el sistema de \"enfriamiento\": la salida se enciende cuando se alcanza el valor preestablecido del umbral de temperatura superior y se apaga cuando se alcanza el umbral inferior.\nPara determinar el umbral superior e inferior sirve el parámetro histéresis. El umbral superior se determina como la temperatura preestablecida + histéresis. El umbral inferior se determina como el valor de temperatura preestablecido - histéresis.\n\nCaracterísticas:\n - uno o más sensores de temperatura pueden servir como fuentes de valor de temperatura;\n - la precisión del mantenimiento de la temperatura depende de la cantidad de los sensores (con 2 sensores - 0.5 ° С, con 10 sensores - 0.1 ° С)."},{"iso":"de","value":"Das Szenario „Täglicher Mehrsensorenthermostat, Hysteresis“ steuert die Klimaanlage gemäß den gemessenen Werten von Temperatursensor Astra-3731 und weiteren Temperatursensoren Astra. In diesem Szenario können Sie den Systemtyp auswählen, dessen Geräte gesteuert werden sollen: Heizung oder Kühlung. Für das System \"Heizung\"gilt: der Ausgang wird eingeschaltet sobald die untere Temperaturschwelle erreicht und ausgeschaltet, wenn die Temperatur den oberen Schwellwert erreicht wird. Für das System \"Kühlung\"gilt: der Ausgang wird eingeschaltet sobald die obere Temperaturschwelle erreicht wird und ausgeschaltet sobald die Temperatur den unteren Schwellwert erreicht. Die obere und untere Grenze wird mittels \"Hysteresis\" ermittelt. Obere Grenze = Programmierter Temperarturwert + Hysterese, untere Grenze = Programmierter Temperarturwert – Hysterese. Besonderheiten:- als Temperaturquelle kann ein oder mehrere Sensoren angegeben werden; - je nach Tageszeit und Wochentag können verschiedene Solltemperaturwerte festgelegt werden;- die Genauigkeit der eingehaltenen Temperatur hängt von der Anzahl der Sensoren ab (2 Sensoren - 0.5 °C, 10 Sensoren - 0.1 °C)."}],"description_alt":[{"iso":"ru","value":"Сценарий <b>Термостат многозонный суточный, гистерезис</b> предназначен для управления климатическим оборудованием по показаниям <b>одного или нескольких</b> температурных датчиков Астра-3731 и любых других датчиков Астра, передающих информацию о температуре.<br><br>Сценарий позволяет выбрать тип системы, оборудованием которого требуется управлять - <b>отопление или охлаждение</b>.<br><br><b>Для системы «отопление»:</b> выход включается при достижении заданного значения нижней границы температур и выключается при достижении верхней границы.<br><b>Для системы «охлаждение»:</b> выход включается при достижении заданного значения верхней границы температур и выключается при достижении нижней границы.<br><br>Для определения верхних и нижних границ служит параметр <b>«гистерезис»</b>. Верхняя граница - заданное значение температуры + гистерезис. Нижняя граница – заданное значение температуры – гистерезис.<br><br><b>Особенности:</b><br>- в качестве источников температуры может быть указан один или несколько датчиков;<br>- точность поддержания температуры зависит от количества датчиков (для 2 датчиков – 0.5 °С, для 10 датчиков – 0.1 °С)."},{"iso":"en","value":"The <b>Multipoint daily thermostat, hysteresis</b> scenario is designed to control climatic equipment according to the measurements of temperature by <b> one or more </b> temperature sensors Astra-3731 or/and any other Astra sensors that can measure and transmit temperature information. <br> <br> The scenario allows to select the type of the system - <b> heating or cooling </b>. <br> <br> <b> For the \"heating\" system: </b> the output turns on when the pre-set value of the lower threshold is reached and turns off when the upper temperature threshold is reached. <br> <b> For the cooling system: </b> the output turns on when the pre-set value of the upper temperature threshold is reached and turns off when the lower threshold is reached. <br> <br> To determine the upper and lower threshold serves the <b> hysteresis </b> parameter. The upper threshold is determined as the 'pre-set temperature + hysteresis'. The lower threshold is determined as the 'pre-set temperature - hysteresis'. <br> <br> <b> Features: </b> <br> - one or more sensors can be specified as temperature sources; <br> - the accuracy of temperature maintenance depends on the quantity of sensors (with 2 sensors - 0.5 ° С, with 10 sensors - 0.1 ° С)."},{"iso":"es","value":"El escenario <b>Termostato multizona de ciclo diário, histéresis</b> está diseñado para controlar equipos climáticos midiendo la temperatura mediante <b> uno o más </b> sensores de temperatura Astra-3731 o cualquier otro sensor Astra que pueda medir y transmitir Información de temperatura. <br> <br> El escenario permite seleccionar el tipo de sistema: <b> calefacción o enfriamiento </b>. <br> <br> <b> Para el sistema de \"calefacción\": </b> la salida se enciende cuando se alcanza el valor preestablecido del umbral inferior y se apaga cuando se alcanza el umbral de temperatura superior. <br> <b> Para el sistema de \"enfriamiento\": </b> la salida se enciende cuando se alcanza el valor preestablecido del umbral de temperatura superior y se apaga cuando se alcanza el umbral inferior. <br> <br> Para determinar el umbral superior e inferior sirve el parámetro <b> histéresis </b>. El umbral superior se determina como la temperatura preestablecida + histéresis. El umbral inferior se determina como el valor de temperatura preestablecido - histéresis. <br> <br> <b> Características: </b> <br> - uno o más sensores de temperatura pueden servir como fuentes de valor de temperatura; <br> - la precisión del mantenimiento de la temperatura depende de la cantidad de los sensores (con 2 sensores - 0.5 ° С, con 10 sensores - 0.1 ° С)."},{"iso":"de","value":"Das Szenario <b>Täglicher Mehrsensorenthermostat, Hysteresis</b> steuert die Klimaanlage gemäß den gemessenen Werten von Temperatursensor Astra-3731 und weiteren Temperatursensoren Astra.<br><br>In diesem Szenario können Sie den Systemtyp auswählen, dessen Geräte gesteuert werden sollen: <b>Heizung oder Kühlung</b>.<br><br><b>Für das System \"Heizung\" gilt:</b> der Ausgang wird eingeschaltet sobald die untere Temperaturschwelle erreicht wird und ausgeschaltet, wenn die Temperatur den oberen Schwellwert erreicht.<br><b>Für das System \"Kühlung\"gilt:</b> der Ausgang wird eingeschaltet sobald die obere Temperaturschwelle erreicht wird und ausgeschaltet sobald die Temperatur den unteren Schwellwert erreicht.<br><br>Die obere und untere Grenze werden mittels <b>\"Hysteresis\"</b> ermittelt. Obere Grenze = programmierter Temperarturwert + Hysterese, untere Grenze = programmierter Temperarturwert - Hysterese.<br><br><b>Besonderheiten:</b><br>- als Temperaturquelle kann ein oder mehrere Sensoren angegeben werden;<br> - je nach Tageszeit und Wochentag können verschiedene Solltemperaturwerte festgelegt werden;<br>- die Genauigkeit der eingehaltenen Temperatur hängt von der Anzahl der Sensoren ab (2 Sensoren - 0.5 °C, 10 Sensoren - 0.1 °C)."}],"source":"; common TOS sizes\nb equ 0\nw equ 1\ndw equ 2\n\n; settings\ntemp equ 25 ; (param) target temperature during the specified period \ndef equ 25 ; (param) temperature at other times\nfrom equ 1 ; (param) start of the period\nto equ 23 ; (param) end of the period\n\nhysteresis equ 50 ; (param) allowable temperature spread\n\nzone_mask equ 3 ; (param) mask of selected zones (max 4294967295)\ntime_zone equ 0 ; (param) time offset on minutes\n\naction equ 1 ; (param) relay action value\nnot_inversion equ 1 ; (param) flag that output not inverted\n\npb macro ; byte\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\npw macro ; word\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\npd macro ; dword\n psh (($1 >> 28) & 15)\n nib (($1 >> 24) & 15)\n psh (($1 >> 20) & 15)\n nib (($1 >> 16) & 15)\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; mov instruction with parameters\nup macro\n psh (((($1 & 3) | ($2 << 2)) >> 4) & 15)\n nib (($1 & 3) | ($2 << 2) & 15)\n mov\nendm\n\n; exp instruction with parameters\nex macro\n psh ($1 & 3)\n nib ((($3 & 1) << 3) | ($2 & 3))\n exp\nendm\n\n\n; BEGIN\n ; get target temp on period increased by 50\n ; to get rid of minus\n pb temp + 50\n ; get temp on other time increased by 50\n ; to get rid of minus\n pb def + 50\n psh to ; get end of the period\n psh from ; get start of the period\n ; go calculate period times considering the selected timezone\n pb check_timezone\n jmp b\n ; now we have temperature & previous switch value in TOS\n ;swp b\n ; get temperature value from zone\nget_temp\n ; multiply target temperature by 10\n ex b, w, 1\n pw 10\n mul w\n \n pw 0 ; set 'temperature summ'\n psh 0 ; set 'checked zone count'\n pd zone_mask ; get 'zone mask'\n psh 0 ; set 'current zone id'\nloop\n ; increment current zone id\n inc b\n ; check if it was last zone\n dup b\n psh 33\n cmp b\n ; if was last - go calculate average temperature\n ; else - check if need to check zone temperature\n skp\n bra check_mask\n pb calc_tmp\n jmp b\ncheck_mask\n up dw, 1 ; bring 'zone mask' to top\n dup b ; save lower byte of 'zone mask'\n ; check if need to get next zone temperature\n psh 1\n and b\n pop b\n ; if need - go get temperature\n ; else - shift mask\n skz\n bra zone_match ; 1\n    ; 0\n \nshift_mask\n ; divide mask to 2 to shift mask right\n psh 2\n ex b, dw, 0\n div dw\n up b, 4 ; bring 'current zone id' to top\n bra loop\n\nzone_match\n ; bring 'current zone id' to top\n up b, 4\n dup b ; save 'current zone id'\n ; get temperature of current zone\n ex b, w, 0\n pw ZONE_TEMPERATURE_BASE - 1\n add w\n inp w, b\n ex b, w, 1\n ; add 50 to it to get rid of a minus\n pw 50\n add w\n up w, 8 ; bring temperatures sum\n add w ; add temperature of current zone to summ\n up b, 7 ; bring 'checked zone count'\n inc b ; increment 'checked zone count'\n up b, 3 ; get 'current zone id' to top\n up dw, 4 ; get 'zone mask' to top\n pb shift_mask\n jmp b\n \ncalc_tmp\n pop b ; dispose 'current zone id'\n pop dw ; dispose 'zones mask'\n ex b, w, 0 ; expand 'checked zone count' \n swp w ; bring 'temperature summ' to top\n ; mutiply it by 10\n pw 10\n mul w\n swp w ; bring 'checked zone count' to top\n ; divide 'temperature summ' to 'checked zone count'\n ; to get average temperature\n div w\n\n ; implement hysteresis )))\n pw hysteresis / 10\n up b, 6 ; bring 'last state' to top\n ; calculate last relay action\n psh action\n xor b\n pop b\n snz\n bra was_on\nwas_off\n ; add hysteresis to 'average temperature'\n add w\n ; compare increased 'average temperature' and 'target temperature'\n cmp w\n ; if equal - set on\n ; else - check if 'target temperature' is greater\n snz\n bra set_on\n bra done\nwas_on\n ; if was off we should check hysteresis loop for upper rim\n sub w\n cmp w\n snz\n bra set_off\ndone\n ; if 'target temperature' is greater - set on\n ; else - set off\n skp\n bra set_off\n \nset_on\n psh action & not_inversion & 1\n ret\n \nset_off\n psh ~action & ~not_inversion & 1\n ret\n\ncheck_timezone\n ; calculate 'start period time' in minutes\n ex b, w, 0\n pw 60\n mul w\n up b, 2 ; bring 'end period time' to top\n ; calculate 'end period time' in minutes\n ex b, w, 0\n pw 60\n mul w\n pw time_zone ; get selected timezone in minutes\n dup w ; save timezone\n pw 32768 ; set minus flag\n and w ; calculate if timezone is negative\n pop w ; read minus flag\n ; if timezone is negative - get timezone with no minus sign and go calculate period time considering timezone\n ; else - calculate period time considering timezone\n snz\n bra plus\n pop w ; dispose timezone\n pw time_zone * -1 ; get positive timezone\n psh 2 ; set ???\n bra loop_m\n \nplus\n ; calculate period start time considering timezone\n sub w\n ; if result is negative - add 24 hours to get proper period start time\n ; else - go calculate period end time\n skn\n bra second\n pw 1440\n add w\n \nsecond\n swp w ; bring 'period end time' to top\n pw time_zone ; get selected timezone in minutes\n ; calculate period end time considering timezone\n sub w\n ; if result is negative - add 24 hours to get proper period end time\n ; else - go check time span\n skn\n bra check_time_span\n pw 1440\n add w\n bra check_time_span\n \nminus\n pw time_zone * -1 ; get positive timezone\n up b, 2 ; bing ??? to top\nloop_m\n up dw, 1 ; bring 'timezone' and end or  'period time' to top\n add w ; add 'timezone' to 'end period time'\n dup w ; save 'offseted end period time'\n ; substract 24 from 'offseted end period time'\n pw 1440\n sub w\n ; if result is negative - dispose result \n ; else - dispose 'offseted end period time'\n skn\n swp w\n pop w\n up b, 2 ; bring ??? to top\n dec b ; decrement ???\n ; if ??? is zero - dispose it and check time span\n ; else - find 'offseted start period time'\n skz\n bra minus\n pop b\n; subroutine to return value for time span\n; on entry TOS contains:\n;   hour from\n;   hour to\n;   matched value\n;   default value\n; on return TOS byte will be the desired value\n; NOTE: due to optimisation entry point should reside within 63 first addresses \ncheck_time_span\n ; save 'start period' and 'end period' \n dup dw\n ; compare 'start period' and 'end period'\n\n cmp w\n ; prepare check time greater or equals than 'from'\n pb get_now\n for b\n swp w ; swap so that N-flag reflects the result\n ; compare 'start period time' and 'end period time'\n ; if 'end period time' greater - time continuous\n ; else - time split\n skn\n bra time_continuous\n; time interval within connected days \ntime_split\n ; compare 'current day time' and 'start period time'\n cmp w\n ; if 'current day time' greater - go to time_check_enough\n ; else go to time_check_to to check 'end period time'\n skn\n bra time_check_enough\n bra time_check_to\n; time interval within one day \ntime_continuous\n ; compare 'current day time' and 'start period time'\n ; if 'current day time' greater - go check 'end period time'\n ; else - go to time_check_enough\n cmp w\n skp\n bra time_check_enough\ntime_check_to\n ; get current time of day\n pb get_now\n for b\n ; compare 'current day time' and 'end period time'. result in n-flag\n cmp w\n ; result is flag N\n bra check_time_span_ret\ntime_check_enough\n ; dispose unused 'to' \n pop w\ncheck_time_span_ret\n ; if 'current day time' greater - set flag to check detector\n ; else continue\n skp\n swp b\n snz\n swp b\n ; dispose either matched or default value\n pop b\n pb get_temp\n jmp b\n\nget_now\n pb RT_HOUR\n inp b, w\n pw 60\n mul w\n pb RT_MIN\n inp b, w\n add w\n up b, 2\n jmp b","params":[{"name":"time_zone","format":"^((-([1-9]|[1-8][0-9]|9[0-9]|[1-6][0-9]{2}|7[01][0-9]|720))|([0-9]|[1-8][0-9]|9[0-9]|[1-7][0-9]{2}|8[0-3][0-9]|840))$","type":"time_zone_m","description":[{"iso":"ru","value":"Часовой пояс"},{"iso":"en","value":"Time zone"},{"iso":"es","value":"Zona horaria"},{"iso":"de","value":"Zeitzone"}]},{"name":"action","format":"^([01])$","type":"list","default":"1","extra":[{"name":"heat","description":[{"iso":"ru","value":"Нагрев"},{"iso":"en","value":"Heating"},{"iso":"es","value":"Calefacción"},{"iso":"de","value":"Heizung"}],"value":"1"},{"name":"cold","description":[{"iso":"ru","value":"Охлаждение"},{"iso":"en","value":"Cooling"},{"iso":"es","value":"Enfriamiento"},{"iso":"de","value":"Kühlung"}],"value":"0"}],"description":[{"iso":"ru","value":"Тип системы"},{"iso":"en","value":"System type"},{"iso":"es","value":"Tipo de sistema"},{"iso":"de","value":"Systemtyp"}]},{"name":"not_inversion","format":"^([01])$","type":"list","default":"1","extra":[{"name":"no","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"No"},{"iso":"es","value":""},{"iso":"de","value":""}],"value":"1"},{"name":"yes","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"Yes"},{"iso":"es","value":""},{"iso":"de","value":""}],"value":"0"}],"description":[{"iso":"ru","value":"Инверсия"},{"iso":"en","value":"Inversion"},{"iso":"es","value":""},{"iso":"de","value":""}]},{"name":"zone_mask","format":"^([0-9]|[1-8][0-9]|9[0-9]|[1-8][0-9]{2}|9[0-8][0-9]|99[0-9]|[1-8][0-9]{3}|9[0-8][0-9]{2}|99[0-8][0-9]|999[0-9]|[1-8][0-9]{4}|9[0-8][0-9]{3}|99[0-8][0-9]{2}|999[0-8][0-9]|9999[0-9]|[1-8][0-9]{5}|9[0-8][0-9]{4}|99[0-8][0-9]{3}|999[0-8][0-9]{2}|9999[0-8][0-9]|99999[0-9]|[1-8][0-9]{6}|9[0-8][0-9]{5}|99[0-8][0-9]{4}|999[0-8][0-9]{3}|9999[0-8][0-9]{2}|99999[0-8][0-9]|999999[0-9]|[1-8][0-9]{7}|9[0-8][0-9]{6}|99[0-8][0-9]{5}|999[0-8][0-9]{4}|9999[0-8][0-9]{3}|99999[0-8][0-9]{2}|999999[0-8][0-9]|9999999[0-9]|[1-8][0-9]{8}|9[0-8][0-9]{7}|99[0-8][0-9]{6}|999[0-8][0-9]{5}|9999[0-8][0-9]{4}|99999[0-8][0-9]{3}|999999[0-8][0-9]{2}|9999999[0-8][0-9]|99999999[0-9]|[1-3][0-9]{9}|4[01][0-9]{8}|42[0-8][0-9]{7}|429[0-3][0-9]{6}|4294[0-8][0-9]{5}|42949[0-5][0-9]{4}|429496[0-6][0-9]{3}|4294967[01][0-9]{2}|42949672[0-8][0-9]|429496729[0-5])$","type":"zones","description":[{"iso":"ru","value":"Датчики температуры"},{"iso":"en","value":"Temperature sensors"},{"iso":"es","value":"Sensores de temperatura"},{"iso":"de","value":"Temperatursensoren"}]},{"name":"hysteresis","format":"^([1-8][0-9]|9[0-9]|[1-8][0-9]{2}|9[0-8][0-9]|990)$","type":"xfloat","default":"50","description":[{"iso":"ru","value":"Гистерезис"},{"iso":"en","value":"Hysteresis"},{"iso":"es","value":"Histéresis"},{"iso":"de","value":"Hysteresis"}]},{"name":"from","format":"^([0-9]|1[0-9]|2[0-3])$","type":"int","description":[{"iso":"ru","value":"\"Время от\" (час)"},{"iso":"en","value":"\"Time from\" (hour)"},{"iso":"es","value":"\"Tiempo desde\" (hora)"},{"iso":"de","value":"\"Zeit von\" (Stunden)"}]},{"name":"to","format":"^([0-9]|1[0-9]|2[0-3])$","type":"int","description":[{"iso":"ru","value":"\"Время до\" (час)"},{"iso":"en","value":"\"Time to\" (hour)"},{"iso":"es","value":"\"Tiempo hasta\" (hora)"},{"iso":"de","value":"\"Zeit bis\" (Stunden)"}]},{"name":"temp","format":"^\\-?([0-9]|[1-4][0-9]|50)$","type":"int","description":[{"iso":"ru","value":"Температура в указанный период"},{"iso":"en","value":"Temperature to maintain within the indicated period"},{"iso":"es","value":"Temperatura en el periodo indicado"},{"iso":"de","value":"Temperatur zum angegebenen Zeitpunkt"}]},{"name":"def","format":"^\\-?([0-9]|[1-4][0-9]|50)$","type":"int","description":[{"iso":"ru","value":"Температура в остальное время"},{"iso":"en","value":"Temperature to maintain during the rest of the time"},{"iso":"es","value":"Temperatura durante el resto del tiempo"},{"iso":"de","value":"Temperatur zu übrigen Zeitpunkten"}]}],"firmwares":["22544641","22544643","22610177","22610179","22675715","22741251","39452932","22806787","22872323","39584004","22937859","39649540","23068931","39846148","23134467","39911684","40042756","23527683","23593219","23265537","40435972","23658755","23724291","23789827","23855363","40632580","23920899","24183043"]}