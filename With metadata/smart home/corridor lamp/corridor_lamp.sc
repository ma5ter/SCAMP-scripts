{"script_uid":"lamp-wn45y5-356rhk-w5uw5r-4eha45","category":[{"iso":"ru","value":"/Умный дом"},{"iso":"en","value":"/Smart Home"},{"iso":"es","value":"/Casa inteligente"},{"iso":"de","value":"/Smart Home"}],"name":[{"iso":"ru","value":"Коридорное освещение"},{"iso":"en","value":"Corridor lighting"},{"iso":"es","value":"Iluminación de pasillo"},{"iso":"de","value":"Korridorbeleuchtung"}],"description":[{"iso":"ru","value":"Сценарий 'Коридорное освещение' меняет состояние управляемого им выхода в зависимости от состояния выбранных источников следующим образом:\n - выход включается при появлении нарушения в одной из отслеживаемых зон в заданный период времени;\n - выход выключается по истечении настраиваемого времени продолжительности работы после окончания нарушения в одной из отслеживаемых зон.\nДля применения обратной логики работы сценария необходимо включить инверсию при настройке параметров сценария.\n\nВнимание! При установке продолжительности работы необходимо учитывать, что:\n - отсчет времени начинается с момента окончания нарушения в зоне;\n - для беспроводных реле (Астра-8231, Астра-8731) продолжительность работы может быть больше заданной на интервал времени до 10 сек."},{"iso":"en","value":"The 'Corridor lighting' scenario changes the state of the output depending on the state of zones as follows:\n - the output turns on when the violation event occurs in the zone;\n - the output turns off after the pre-set time of execution of scenario after the violation event in the zone ends.\nThe scenario is inverted by setting the Inversion parameter to ON.\n\nWarning! When setting duration of execution of the scenario, it is necessary to take into account that:\n - the countdown starts from the moment the violation event ends in the zone;\n - for wireless relay modules (Astra-8231, Astra-8731) the duration of execution of the scenario can be longer than the specified time interval for up to 10 sec."},{"iso":"es","value":"El escenario 'Iluminación del pasillo' cambia el estado de la salida según el estado de las zonas de la siguiente manera:\n - la salida se enciende cuando se produce una violación en la zona monitoreada;\n - la salida se apaga después del tiempo de la ejecución del escenario configurable después de que una violación en la zona monitoreada ha expirado.\nPara utilizar la lógica inversa del escenario, es necesario activar el parámetro Inversión.\n\n¡Atención! Al establecer la duración de la ejecución del escenario, es necesario tener en cuenta que:\n la cuenta regresiva comienza desde el momento en que finaliza la violación en la zona;\n para los módulos de relé inalámbricos (Astra-8231, Astra-8731) la duración de la ejecución puede ser mayor que el intervalo del tiempo especificado por hasta 10 seg."},{"iso":"de","value":"Das Szenario „Flurbeleuchtung“ ändert den Zustand des gesteuerten Relais in Abhängigkeit des Zustandes des überwachten Bereiches wie folgt: - das Relais wird eingeschaltet, sobald im überwachten Bereich eine Störung vorliegt; - das Relais wird ausgeschaltet nach Ablauf der eingestellten Arbeitsdauer nachdem die Störung behoben wurde. Um die umgekehrte Logik zu realisieren, muss die Inversion in den Einstellungen des Szenarios ausgewählt werden. Achtung! Bei der Einstellung der Arbeitsdauer muss berücksichtigt werden, dass: - die Zeit erst nachdem die Störung behoben wurde startet: - die Arbeitsdauer für die Funkrelais (Astra-8231, Astra-8731) sich auf bis zu 10 Sekunden verlängert kann."}],"description_alt":[{"iso":"ru","value":"Сценарий <b>Коридорное освещение</b> меняет состояние управляемого им выхода в зависимости от состояния выбранных источников следующим образом:<br><br> - реле <b>включается</b> при появлении нарушения в одной из отслеживаемых зон в заданный период времени;<br> - реле <b>выключается</b> по истечении настраиваемого времени продолжительности работы после окончания нарушения в отслеживаемых зонах.<br>Для применения обратной логики работы сценария необходимо включить инверсию при настройке параметров сценария.<br><br>Внимание! При установке продолжительности работы необходимо учитывать, что:<br>- отсчет времени начинается с момента окончания нарушения в зоне;<br>- для радиоканальных реле (Астра-8231, Астра-8731) продолжительность работы может быть больше заданной на интервал времени до 10 сек."},{"iso":"en","value":"The <b>Corridor lighting</b> scenario changes the state of the output depending on the state of zones as follows: <br> <br> -output <b> turns on </b> when the Violation event occurs in the zone; <br> -output <b> turns off </b> after the pre-set time of execution of scenario after the Violation event in the zone ends. <br> The scenario is inverted by setting the Inversion parameter to ON. <br> <br> Warning! When setting duration of execution of the scenario, it is necessary to take into account that: <br> - the countdown starts from the moment the Violation event ends in the zone ; <br> - for wireless relay modules (Astra-8231, Astra-8731), the duration of execution of the scenario can be longer than the specified time interval for up to 10 sec."},{"iso":"es","value":"El escenario <b> Iluminación del pasillo</b> cambia el estado de la salida según el estado de las zonas de la siguiente manera: <br> <br> - la salida <b> se enciende </b> cuando se produce una violación en la zona monitoreada; <br> - la salida <b> se apaga </b> después del configurable después de que una violación en la zona monitoreada ha expirado. <br> Para utilizar la lógica inversa del escenario, es necesario activar el parámetro Inversión. <br> <br> ¡Atención! Al establecer la duración de la ejecución del escenario, es necesario tener en cuenta que: <br> - la cuenta regresiva comienza desde el momento en que finaliza la violación en la zona; <br> - para los módulos de relé inalámbricos (Astra-8231, Astra-8731) la duración de la ejecución puede ser mayor que el intervalo del tiempo especificado por hasta 10 seg."},{"iso":"de","value":"Das Szenario <b>Flurbeleuchtung</b> ändert den Zustand des gesteuerten Relais in Abhängigkeit des Zustandes des überwachten Bereiches wie folgt:<br><br>- das Relais <b>wird eingeschaltet</b>, sobald im überwachten Bereich eine Störung vorliegt;<br>- das Relais <b>wird ausgeschaltet</b> nach Ablauf der eingestellten Arbeitsdauer nachdem die Störung behoben wurde.<br><br>Um die umgekehrte Logik zu realisieren, muss die Inversion in den Einstellungen des Szenarios ausgewählt werden.<br><br>Achtung! Bei der Einstellung der Arbeitsdauer muss berücksichtigt werden, dass:<br>- die Zeit erst nachdem die Störung behoben wurde startet;<br>- die Arbeitsdauer für die Funkrelais (Astra-8231, Astra-8731) sich auf  bis zu  10 Sekunden verlängert kann."}],"source":"; corridor lamp\n\n; settings\n;source_zones equ 1 ; (param) zone id to detect from\n;delay_to_off equ 45 ; (param) time to off after no detection (up to 16 bits in seconds)\n;active_state equ 1 ; (param) what to do `on` or `off` when active\n;from equ 1212 ; (param) period start time in minutes\n;to equ 1212 ; (param) period end time in minutes\n\n; common TOS sizes\nb equ 0\nw equ 1\ndw equ 2\n\n; push byte macro\npb macro\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; push word macro\npw macro\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\npd macro ; dword\n psh (($1 >> 28) & 15)\n nib (($1 >> 24) & 15)\n psh (($1 >> 20) & 15)\n nib (($1 >> 16) & 15)\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; mov instruction with parameters\nup macro\n psh (((($1 & 3) | ($2 << 2)) >> 4) & 15)\n nib (($1 & 3) | ($2 << 2) & 15)\n mov\nendm\n\n; exp instruction with parameters\nex macro\n psh ($1 & 3)\n nib ((($3 & 1) << 3) | ($2 & 3))\n exp\nendm\n\n; BEGIN\n ; check 'last state'\n ; if 'last state' is active - check detector\n ; else - continue\n psh active_state\n xor b\n pop b\n snz\n bra check_detector\n pw to ; get 'start period time'\n pw from ; get 'end period time'\n ; compare 'start period time' and 'end period time'\n ; if they are equal - dispose period times and go check detector\n ; else go check_time_span\n dup dw\n cmp w\n skz\n bra has_timetable\nno_timetable\n pop dw\n bra check_detector\nhas_timetable\n pb check_time_span\n jmp b\n\ncheck_sched\n ; read flag to check detector or not\n ; if has flag - check detector\n ; else - deactivate\n pop b\n skz\n bra check_detector\n pb do_deactivate\n jmp b\n \ncheck_detector\n ; get 'source zones mask'\n pd source_zones\n ; set 'current zone id'\n psh 0\nloop\n ; increment 'current zone id'\n inc b\n dup b ; save 'current zone id'\n ; check if all zones iterated\n ; if yes - no active detector - set off\n ; else - continue\n psh 33\n cmp b\n skp\n bra continue\nno_active_detectors\n pb detector_inactive\n jmp b\ncontinue\n up dw, 1 ; bring 'source zones mask' to top\n dup b ; save low byte\n psh 1 ; set 1 for check\n ; check if curent zone should be checked\n ; if yes - check current zone\n ; else - shift source zones mask\n and b\n pop b\n skz\n bra zone_match ; 1\n \nshift_mask\n ; shift source zones mask right by dividing to 2\n psh 2\n ex b, dw, 0\n div dw\n up b, 4 ; bring 'current zone id' to top\n ; continue loop\n bra loop\n \nzone_match\n up b, 4 ; bring 'current zone id' to top\n dup b ; save 'current zone id'\n ex b, w, 0 ; expand it to word\n pw ZONE_DETECT_FLAG_BASE - 1 ; get zone detect base\n add w ; calculate address of current zone detect flag\n inp w, b ; get current zone detect flag\n pop b ; read detect flag\n ; if has flag - set on\n ; else - shift mask and continue\n skz\n bra detector_active\n up dw, 1\n bra shift_mask\n\ndetector_inactive\n ; dispose 'current zone id' and 'source zones mask'\n pop b\n pop dw\n ; check off time\n dup dw ; save 'off time'\n ; get current timestamp\n pb TIMESTAMP\n inp b, dw\n ; compare 'current timestamp' and 'off time'\n ; if 'current timestamp' greater - dispose 'off time' and deactivate\n ; else - activate\n cmp dw\n skn\n bra do_activate\n pop dw\n\ndo_deactivate\n psh ~active_state & 1\n ret\n\ndetector_active\n ; dispose 'current zone id' and 'source zones mask'\n pop b\n pop dw\n ; dispose previous 'off time'\n pop dw\n ; calculate new 'off time' and activate\n pb TIMESTAMP\n inp b, dw\n pw delay_to_off\n ex w, dw, 1\n add dw\n \ndo_activate \n psh active_state & 1\n ret\n \n\ncheck_time_span\n dup dw\n cmp w\n pb get_now\n for b\n swp w ; swap so that N-flag reflects the result\n ; compare 'start period time' and 'end period time'\n ; if 'end period time' greater - time continuous\n ; else - time split\n skn\n bra time_continuous\n; time interval within connected days \ntime_split\n ; compare 'current day time' and 'start period time'\n ; if 'current day time' greater - go to time_check_enough\n ; else go to time_check_to to check 'end period time'\n cmp w\n skn\n bra time_check_enough\n bra time_check_to\n; time interval within one day \ntime_continuous\n ; compare 'current day time' and 'start period time'\n ; if 'current day time' greater - go check 'end period time'\n ; else - go to time_check_enough\n cmp w\n skp\n bra time_check_enough\ntime_check_to\n ; get current time of day\n pb get_now\n for b\n ; compare 'current day time' and 'end period time'. result in n-flag\n cmp w\n bra check_time_span_ret\ntime_check_enough\n ; dispose unused 'to' \n pop w\ncheck_time_span_ret\n ; if 'current day time' greater - set flag to check detector\n ; else continue\n skn\n inc b\n snz\n dec b\n ; dispose either matched or default value\n pb check_sched\n jmp b\n\n; get current time of day in minutes\nget_now\n pb RT_HOUR\n inp b, w\n pw 60\n mul w\n pb RT_MIN\n inp b, w\n add w\n up b, 2\n jmp b\n","params":[{"name":"source_zones","type":"zones","description":[{"iso":"ru","value":"Отслеживаемые датчики"},{"iso":"en","value":"Sensors"},{"iso":"es","value":"Sensores"},{"iso":"de","value":"Sensoren"}]},{"name":"delay_to_off","format":"^([0-9]|[1-8][0-9]|9[0-9]|[1-8][0-9]{2}|9[0-8][0-9]|99[0-9]|[1-8][0-9]{3}|9[0-8][0-9]{2}|99[0-8][0-9]|999[0-9]|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-5])$","type":"int","description":[{"iso":"ru","value":"Продолжительность работы (в секундах)\nВнимание! При установке продолжительности работы необходимо учитывать, что:\n - отсчет времени начинается с момента окончания нарушения в зоне;\n - для радиоканальных реле (Астра-8231, Астра-8731) продолжительность работы может быть больше заданной на интервал времени до 10 сек."},{"iso":"en","value":"Duration (seconds) Attention! When setting the duration, it is necessary to take into account that:\n - the countdown starts from the moment the violation in the zone ends;\n - for wireless relay modules (Astra-8231, Astra-8731), the duration can be longer than specified for a time interval of up to 10 seconds."},{"iso":"es","value":"Al establecer la duración de la ejecución del escenario, es necesario tener en cuenta que:\n - la cuenta regresiva comienza desde el momento en que finaliza la violación en la zona;\n - para los módulos de relé inalámbricos (Astra-8231, Astra-8731) la duración de la ejecución puede ser mayor que el intervalo del tiempo especificado por hasta 10 seg."},{"iso":"de","value":"Die Arbeitsdauer (in Sekunden). Achtung! Bei der Einstellung der Arbeitsdauer muss berücksichtigt werden, dass:<br>-die Zeit erst nachdem die Störung behoben wurde startet;<br>-die Arbeitsdauer für die Funkrelais (Astra-8231, Astra-8731) sich auf bis zu 10 Sekunden verlängert kann."}]},{"name":"active_state","format":"^([01])$","type":"list","default":"1","extra":[{"name":"turn_on","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"1"},{"name":"turn_off","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"0"}],"description":[{"iso":"ru","value":"Инверсия"},{"iso":"en","value":"Inversion"},{"iso":"es","value":"Inversión"},{"iso":"de","value":"Invertieren"}]},{"name":"from","format":"^([0-9]|[1-9][0-9]{1,2}|1[0-3][0-9]{2}|14[0-3][0-9])$","type":"time_m_utc","default":0,"required":false,"description":[{"iso":"ru","value":"Начало периода"},{"iso":"en","value":"Beginning of period"},{"iso":"es","value":"Comienzo del período"},{"iso":"de","value":"Beginn der Periode"}]},{"name":"to","format":"^([0-9]|[1-9][0-9]{1,2}|1[0-3][0-9]{2}|14[0-3][0-9])$","type":"time_m_utc","default":0,"required":false,"description":[{"iso":"ru","value":"Конец периода"},{"iso":"en","value":"End of period"},{"iso":"es","value":"Fin del periodo"},{"iso":"de","value":"Ende der Periode"}]}],"firmwares":["67111504","21954820","21889283","21954819","22020353","22020355","22020356","22151427","22216961","22216963","22216964","22282499","22348035","22413571","22479107","22544641","22544643","22610177","22610179","22675715","22741251","39452932","22806787","22872323","39584004","22937859","39649540","23068931","39846148","23134467","39911684","39977220","23265539","40042756","40173828","23527683","23593219","23265537","40435972","23658755","23724291","23789827","23855363","40632580","23920899","24117507","24183043"]}