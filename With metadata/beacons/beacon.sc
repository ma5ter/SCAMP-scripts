{"script_uid":"beacon-qht40-y9ea7r5-57j36j-fu76","category":[{"iso":"ru","value":"/Маяки"},{"iso":"en","value":"/Beacons"},{"iso":"es","value":"/Balizas"},{"iso":"de","value":"/Leuchten"}],"name":[{"iso":"ru","value":"Маяк"},{"iso":"en","value":"Beacon"},{"iso":"es","value":"Baliza"},{"iso":"de","value":"Leuchte"}],"description":[{"iso":"ru","value":"Сценарий 'Маяк' меняет состояние управляемого им выхода в зависимости от состояния (взят/снят) и наличия тревоги в отслеживаемых разделах следующим образом:\n - выход включается при постановке на охрану всех отслеживаемых разделов(непрерывное свечение маяка);\n - выход выключается при снятии с охраны любого из отслеживаемых разделов(маяк не светится);\n - выход включается и выключается с заданной периодичностью при тревоге в любом из отслеживаемых разделов(прерывистое свечение маяка);\n - если включен режим \"Я дома\", выход включается и выключается с заданной периодичностью, если устройство частично взято;\n - если включен режим индикации задержки, выход включается и выключается с заданной периодичностью, если в отслеживаемом разделе идет задержка на вход/выход;\n - если включен режим учета не только охранных разделов, так же учитываются другие типы разделов как всегда взятые;\n - если включен режим индикации паники как тревога, выход включается и выключается с заданной периодичностью, если подана команда \"Нападение\""},{"iso":"en","value":"The 'Beacon' scenario changes the state of the output depending on the state (armed/disarmed) or presence of alarm events of the assigned partitions as follows:\n - the output turns on when arming all assigned partitions (continuous light);\n - the output turns off when disarming any of the assigned partitions (not lit);\n - the output turns on and off with the specified frequency when an alarm event occurs in any of assigned partitions (intermittent light)"},{"iso":"es","value":"El escenario 'Baliza' cambia el estado de la salida dependiendo del estado (armado/desarmado) o la presencia de evento de alarma en las secciones asignadas de la siguiente manera:\n - la salida se enciende cuando se establece en armado de todas las secciones asignadas (luz continua);\n - la salida se apaga al desarmar cualquiera de las secciones asignadas (la baliza no se enciende);\n - la salida se enciende y se apaga con la frecuencia especificada cuando una alarma ocurre en cualquiera de las secciones asignadas (luz intermitente)"},{"iso":"de","value":"Das Szenario \"Leuchte\" ändert den Zustand des gesteuerten Relais in Abhängigkeit von Zuständen (scharf/unscharf) und Alarm in den überwachten Bereichen wie folgt: - der Ausgang schaltet sich aus, wenn alle Bereiche scharfgeschaltet werden (signalisiert durch das ununterbrochene Leuchten); - der Ausgang schaltet sich aus, sobald einer der überwachten Bereiche unscharfgeschaltet wird (die Leuchte bleibt aus); - der Ausgang schaltet sich mit festgelegter Periodizität ein und aus bei Alarm in einem der überwachten Bereiche (signalisiert durch das unterbrochene Leuchten)."}],"description_alt":[{"iso":"ru","value":"Сценарий <b>Маяк</b> меняет состояние управляемого им выхода в зависимости от состояния (взят/снят) и наличия тревоги в отслеживаемых разделах следующим образом:<br> - выход включается при постановке на охрану всех отслеживаемых разделов(непрерывное свечение маяка);<br> - выход выключается при снятии с охраны любого из отслеживаемых разделов(маяк не светится);<br> - выход включается и выключается с заданной периодичностью при тревоге в любом из отслеживаемых разделов(прерывистое свечение маяка);<br> - если включен режим \"Я дома\", выход включается и выключается с заданной периодичностью, если устройство частично взято;<br> - если включен режим индикации задержки, выход включается и выключается с заданной периодичностью, если в отслеживаемом разделе идет задержка на вход/выход;<br> - если включен режим учета не только охранных разделов, так же учитываются другие типы разделов как всегда взятые;<br> - если включен режим индикации паники как тревога, выход включается и выключается с заданной периодичностью, если подана команда \"Нападение\""},{"iso":"en","value":"The <b>Beacon</b> scenario changes the state of the output depending on the state <b>armed/disarmed or alarm events </b> of the assigned partitions as follows: -the output is <b>ON</b> when arming all assigned partitions (continuous light); -the output turns <b>OFF</b> when disarming any of the assigned partitions (not lit); - turns ON and OFF with the specified frequency when an alarm event occurs in any of the assigned partitions (<b >intermittent light</b>)"},{"iso":"es","value":"El escenario <b>Baliza</b> cambia el estado de la salida dependiendo del estado <b>armado/desarmado o evento de alarma</b> en las secciones asignadas de la siguiente manera: -la salida <b>se enciende</b> cuando se establece en armado de todas las secciones asignadas (luz continua); -la salida <b> se apaga </b> al desarmar cualquiera de las secciones asignadas (la baliza no se enciende); - se enciende y se apaga con la frecuencia especificada cuando ocurre una alarma en cualquiera de las secciones asignadas (<b >luz intermitente de la baliza</b>)"},{"iso":"de","value":"Das Szenario <b>Leuchte</b> ändert den Zustand des gesteuerten Relais in Abhängigkeit von Zuständen <b>Scharf-/Unscharfschaltung und Alarm</b> in den überwachten Bereichen wie folgt:<br> - das Relais <b>wird eingeschaltet,</b> sobald alle überwachten Bereiche scharfgeschaltet werden (die Leuchte bleibt ununterbrochen an);<br> - das Relais <b>wird ausgeschaltet,</b> sobald einer der überwachten Bereiche unscharfgeschaltet wird (die Leuchte ist aus);<br>- das Relais wird mit festgelegter Periodizität ein- und ausgeschaltet in Alarmfall in einem der überwachten Bereiche (<b>das Licht bleibt dauerhaft an</b>)."}],"source":"delay_blink_mask equ 256 ; mask of delay indication\nim_home_blink_mask equ 1792 ; mask of i am home indication\nalarm_mask equ 128 ; mask of alarm indication\n\n;sections equ 13 ; (param) monitored sections\n;enable_panic equ 1 ; (param) flag if need to check panic\n;enable_im_home equ 1 ; (param) flag if i am home mode is enabled\n;all_section_types equ 1 ; (param) flag if need to check all types of sections\n;indicate_delays equ 1 ; (param) flag if need to indicate delays\n\n; common TOS sizes\nb equ 0\nw equ 1\ndw equ 2\n\n; results\noff equ 0\non equ 1\n\npb macro ; byte\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\npw macro ; word\n psh (($1 >> 12) & 15)\n nib (($1 >> 8) & 15)\n psh (($1 >> 4) & 15)\n nib ($1 & 15)\nendm\n\n; mov instruction with parameters\nup macro\n psh (((($1 & 3) | ($2 << 2)) >> 4) & 15)\n nib (($1 & 3) | ($2 << 2) & 15)\n mov\nendm\n\n; exp instruction with parameters\nex macro\n psh ($1 & 3)\n nib ((($3 & 1) << 3) | ($2 & 3))\n exp\nendm\n\n; find mask of section\n; (shift 1 left while section number > 0)\nfind_section_mask macro\n dec b  ; 'section number' - 1\n psh $1 ; initiate mask\n shl 1  ; shift left mask\n swp b  ; bring 'section number' up\n dec b  ; 'section number' - 1\n ; if 'section number' is 0 - dispose 'section number' and leave macro\n ; else - bring mask up and continue shifting\n snz\n bra 2\n swp b  ; bring mask up\n bra -7\n pop b  ; dispose 'section number'\nendm\n\n; BEGIN\n ; TOS on entry:\n ; b: previous result\n \n\n \nstart\n pop b ; dispose 'last state'\n \n ; get alarming sections mask\n pb ALARMING_SECTIONS\n inp b, b\n pb sections ; get monitored sections mask\n and b ; calculate monitored alarming sections mask\n pop b ; read result\n ; if there any section is alarming - alarm\n ; else - check if panic is enabled\n skz\n bra alarm\n \ncheck_panic_enabled\n ; get oanic is enabled flag\n psh enable_panic\n ; read\n pop b\n ; if enabled - check panic\n ; else - check delay indication flag\n snz\n bra check_delay_indication_flag\n \ncheck_panic\n ; get panic flag\n pb PANIC\n inp b, b\n ; read panic flag\n pop b\n ; if has panic - alarm\n ; else - check delay indication flag\n snz\n bra check_delay_indication_flag\n\nalarm\n ; get current ticks\n pb TICKS\n inp b, b\n ; get alarm mask\n pb alarm_mask\n ; calculate ticks matching the alarm mask\n and b\n ; read result\n pop b\n ; if match - set on\n ; else - set off\n skz\n psh on ; set on\n ret\n \ncheck_delay_indication_flag\n ; get flag that tells indicate delays or not\n psh indicate_delays\n ; read flag\n pop b\n ; if has flag - check zones\n ; else - check arming\n skz\n bra check_zones\n pb check_arming\n jmp b\n\ncheck_zones\n pw ZONE_SECTION_BASE ; put to stack address of section number of first zone\nloop\n dup w ; save address of 'section number of current zone'\n inp w, b ; get 'section number of current zone'\n dup b ; save 'section number of current zone'\n ; check if section number is anything but 1 or 0\n ; if yes - find section mask\n ; else - continue\n pb 254 ; anything but 1 or 0\n and b\n pop b\n snz\n bra check_section_monitored\n find_section_mask 1\ncheck_section_monitored\n ; check if that section is monitored\n pb sections\n and b\n pop b\n ; if monitored - check delay\n ; else - check next zone\n skz\n bra check_delay ; zone to check\n\ncheck_end_loop\n inc w ; increase address of 'section number of zone'\n dup w ; save 'section number of next zone'\n ; check if it was last zone number\n pw 4128\n ; if it was last - dispose, go check arming\n ; else - continue loop\n cmp w\n skz\n bra loop\n pb no_alarm_dispose\n jmp b\n \ncheck_delay\n dup w ; save address of 'section number of current zone'\n pw ZONE_SECTION_BASE ; get address of 'section number of first zone'\n sub w ; calculate 'number of current zone'\n dup w ; save 'number of current zone'\n pw ZONE_EXITDELAY_FLAG_BASE ; get base address of 'zone exit delay flag'\n add w ; calculate address of 'current zone exit delay flag'\n inp w, b ; get 'current zone exit delay flag'\n ; if has 'zone exit delay flag' - procedure delay\n ; else - check entry delay\n skz\n bra delay\n pop b ; dispose 'zone exit delay flag'\n ; get base address of 'zone entry delay flag'\n pw ZONE_ENTRYDELAY_FLAG_BASE\n add w ; calculate address of 'current zone entry delay flag'\n inp w, b ; get 'current zone entry delay flag'\n ; if has 'entry delay flag' - procedure delay\n ; else - check if it was last zone\n skz\n bra delay\n pop b ; dispose 'zone entry delay flag'\n bra check_end_loop\n \ndelay\n ; dispose 'zone delay flag', 'zone section addres' and 'timer mask'\n pop dw\n ; get current ticks\n pb TICKS\n inp b, w\n ; get alarm mask\n pw delay_blink_mask\n and w ; calculate\n pop w ; read calculation\n ; if result = 0 - set off\n ; else - set on\n skz\n psh on ; set on\n ret\n \n \nno_alarm_dispose\n pop w ; dispose address of 'section number of zone'\ncheck_arming\n ; get guard sections mask\n pb GUARD_SECTIONS\n inp b, b\n ; get armed sections mask\n pb ARMED_SECTIONS\n inp b, b\n ; calculate armed guard sections mask \n and b\n ; check if need to get all sections types state\n psh all_section_types\n ; read\n pop b\n ; if yes - get other sections types mask\n ; else - continue\n snz\n bra get_monitored\n \nget_other_types\n ; get guard sections mask\n pb GUARD_SECTIONS\n inp b, b\n ; invert it to get other sections type mask\n inv b\n ; combine it wit guard sections mask\n ior b\n\nget_monitored\n pb sections\n ; calculate monitored armed sections mask\n and b\n ; if any of monitoed sections is armed - check fully armed, or not\n ; else - set off\n skz\n bra armed\n ; no need to pop/push, TOS is already zero, set off\n ret\n\narmed\n ; get monitored sections mask\n pb sections\n ; compare armed sections with monitored guard sections\n cmp b\n ; if equal - full device armed\n ; else - part of it\n skz\n bra partial\n\nfull\n psh on\n ret\n\npartial\n ; read if i am home mode is enabled\n psh enable_im_home\n pop b\n ; if i am home mode is enabled - blink\n ; else - set off\n snz\n ret\n \nblink_im_home\n ; get current ticks\n pb TICKS\n inp b, w\n ; get 'i am home blink mask'\n pw im_home_blink_mask\n ; calculate\n and w\n ; read\n pop w\n ; if result = 0 - set off\n ; else - set on\n skz\n psh on ; set on\n ret","params":[{"name":"sections","format":"^([0-9]|[1-8][0-9]|9[0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$","type":"sections","description":[{"iso":"ru","value":"Отслеживаемые разделы"},{"iso":"en","value":"Partitions"},{"iso":"es","value":"Secciones"},{"iso":"de","value":"Überwachte Bereiche"}]},{"name":"indicate_delays","format":"^([01])$","type":"list","default":"1","extra":[{"name":"yes","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"1"},{"name":"no","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"0"}],"description":[{"iso":"ru","value":"Включить индикацию задержек"},{"iso":"en","value":"Enable delay indication"},{"iso":"es","value":"Habilitar indicación de retraso"},{"iso":"de","value":"Verzögerungsanzeige aktivieren"}]},{"name":"all_section_types","format":"^([01])$","type":"list","default":"1","extra":[{"name":"yes","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"0"},{"name":"no","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"1"}],"description":[{"iso":"ru","value":"Учитывать только охранные разделы"},{"iso":"en","value":"Consider only guard sections"},{"iso":"es","value":"Considere solo las secciones de guardia"},{"iso":"de","value":"Betrachten Sie nur Schutzabschnitte"}]},{"name":"enable_im_home","format":"^([01])$","type":"list","default":"1","extra":[{"name":"yes","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"1"},{"name":"no","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"0"}],"description":[{"iso":"ru","value":"Включить режим \"Я дома\""},{"iso":"en","value":"Enable \"I'm at home\" mode"},{"iso":"es","value":"Habilitar el modo \"Estoy en casa\""},{"iso":"de","value":"Aktivieren Sie den „Ich bin zu Hause“-Modus"}]},{"name":"enable_panic","format":"^([01])$","type":"list","default":"0","extra":[{"name":"yes","description":[{"iso":"ru","value":"Да"},{"iso":"en","value":"ON"},{"iso":"es","value":"Activado"},{"iso":"de","value":"Ja"}],"value":"1"},{"name":"no","description":[{"iso":"ru","value":"Нет"},{"iso":"en","value":"OFF"},{"iso":"es","value":"Desactivado"},{"iso":"de","value":"Nein"}],"value":"0"}],"description":[{"iso":"ru","value":"Индикация паники как тревога"},{"iso":"en","value":"Panic indication as an alarm"},{"iso":"es","value":"Indicación de pánico como alarma"},{"iso":"de","value":"Panikanzeige als Alarm"}]}],"firmwares":["67111504","21954820","21889283","21954819","22020353","22020355","22020356","22151427","22216961","22216963","22216964","22282499","22348035","22413571","22479107","22544641","22544643","22610177","22610179","22675715","22741251","39452932","22806787","22872323","39584004","22937859","39649540","23068931","39846148","23134467","39911684","39977220","23265539","40042756","40173828","23527683","23593219","23265537","40435972","23658755","23724291","23789827","23855363","40632580","23920899","24117507"]}